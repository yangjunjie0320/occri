SLURMD_NODENAME = hpc-33-16
Start time = Tue Nov 18 06:27:10 PM PST 2025
CUDA_VISIBLE_DEVICES = 0
OMP_NUM_THREADS = 32
MKL_NUM_THREADS = 4
OPENBLAS_NUM_THREADS = 4
PYSCF_MAX_MEMORY = 327680
TMPDIR = /resnick/scratch/yangjunjie//gpu4pyscf-occri/54995816/
PYSCF_TMPDIR = /resnick/scratch/yangjunjie//gpu4pyscf-occri/54995816/
Using GPU device 0
Free memory: 78.68 GB
Total memory: 79.19 GB
#INFO: **** input file is /resnick/groups/changroup/members/junjiey/occri/occri-main/work/c8/main.py ****
import cupy as cp

device = cp.cuda.Device()
print(f"Using GPU device {device.id}")
mem_info = cp.cuda.runtime.memGetInfo()
print(f"Free memory: {mem_info[0] / (1024**3):.2f} GB")
print(f"Total memory: {mem_info[1] / (1024**3):.2f} GB")

import pyscf, gpu4pyscf
from pyscf.pbc import gto
import gpu4pyscf.pbc
from gpu4pyscf.pbc.df import fft_jk

pcell = gto.Cell()
pcell.a = '''
3.5668  0.0000  0.0000
0.0000  3.5668  0.0000
0.0000  0.0000  3.5668
'''
pcell.atom = '''
C     0.0000  0.0000  0.0000    
C     0.8917  0.8917  0.8917
C     1.7834  1.7834  0.0000    
C     2.6751  2.6751  0.8917
C     1.7834  0.0000  1.7834
C     2.6751  0.8917  2.6751
C     0.0000  1.7834  1.7834
C     0.8917  2.6751  2.6751
'''
pcell.basis = 'gth-dzvp'
pcell.pseudo = 'gth-hf-rev'
pcell.verbose = 4
pcell.ke_cutoff = 100
pcell.exp_to_discard = 0.1
pcell.build()

kpts = pcell.make_kpts([2, 2, 2])

from gpu4pyscf.pbc.scf import KRHF, KUHF
mf = KRHF(pcell, kpts)
mf.verbose = 5
mf.conv_tol = 1e-6
mf.max_cycle = 10
mf.exxdiv = None
dm0 = mf.get_init_guess(key='minao')

mf.kernel(dm0)
ene_ref = mf.e_tot

from fftdf import FFTDF
from fftdf import get_k_kpts_occri
mf.with_df = FFTDF(pcell, kpts, with_occri=True, use_gpu=True)
mf.with_df.blksize = 4
mf.kernel(dm0)
ene_sol = mf.e_tot

print("ene_ref = %12.6f" % ene_ref)
print("ene_sol = %12.6f" % ene_sol)
print("error   = %6.2e" % abs(ene_ref - ene_sol))

print("done")
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-33-16.cm.cluster', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed Apr 10 10:29:16 EDT 2024', machine='x86_64')  Threads 32
Python 3.12.12 | packaged by Anaconda, Inc. | (main, Oct 21 2025, 20:16:04) [GCC 11.2.0]
numpy 2.2.6  scipy 1.16.3  h5py 3.15.1
Date: Tue Nov 18 18:27:14 2025
PySCF version 2.8.0
PySCF path  /home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/pyscf/__init__.py
CUDA Environment
    CuPy 13.4.1
    CUDA Path /home/junjiey/anaconda3/envs/gpu4pyscf-occri
    CUDA Build Version 12080
    CUDA Driver Version 12080
    CUDA Runtime Version 12080
CUDA toolkit
    cuSolver (11, 7, 2)
    cuBLAS 120804
    cuTENSOR 20200
Device info
    Device name b'NVIDIA H100 80GB HBM3'
    Device global memory 79.19 GB
    CuPy memory fraction 0.9
    Num. Devices 1
GPU4PySCF 1.4.3
GPU4PySCF path  /home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf

[ENV] PYSCF_TMPDIR /resnick/scratch/yangjunjie//gpu4pyscf-occri/54995816/
[ENV] PYSCF_MAX_MEMORY 327680
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 8
[INPUT] num. electrons = 32
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 C      0.891700000000   0.891700000000   0.891700000000 AA    1.685068785275   1.685068785275   1.685068785275 Bohr   0.0
[INPUT]  3 C      1.783400000000   1.783400000000   0.000000000000 AA    3.370137570549   3.370137570549   0.000000000000 Bohr   0.0
[INPUT]  4 C      2.675100000000   2.675100000000   0.891700000000 AA    5.055206355824   5.055206355824   1.685068785275 Bohr   0.0
[INPUT]  5 C      1.783400000000   0.000000000000   1.783400000000 AA    3.370137570549   0.000000000000   3.370137570549 Bohr   0.0
[INPUT]  6 C      2.675100000000   0.891700000000   2.675100000000 AA    5.055206355824   1.685068785275   5.055206355824 Bohr   0.0
[INPUT]  7 C      0.000000000000   1.783400000000   1.783400000000 AA    0.000000000000   3.370137570549   3.370137570549 Bohr   0.0
[INPUT]  8 C      0.891700000000   2.675100000000   2.675100000000 AA    1.685068785275   5.055206355824   5.055206355824 Bohr   0.0

nuclear repulsion = -51.1485165824969
number of shells = 24
number of NR pGTOs = 168
number of NR cGTOs = 104
basis = gth-dzvp
ecp = {}
CPU time:         2.43
lattice vectors  a1 [6.740275141, 0.000000000, 0.000000000]
                 a2 [0.000000000, 6.740275141, 0.000000000]
                 a3 [0.000000000, 0.000000000, 6.740275141]
dimension = 3
low_dim_ft_type = None
Cell volume = 306.22
exp_to_discard = 0.1
rcut = 22.07448407082675 (nimgs = [4 4 4])
lattice sum = 365 cells
precision = 1e-08
pseudo = gth-hf-rev
ke_cutoff = 100
    = [33 33 33] mesh (35937 PWs)


******** <class 'gpu4pyscf.pbc.scf.khf.KRHF'> ********
method = KRHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'gpu4pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-06
SCF conv_tol_grad = None
SCF max_cycles = 10
direct_scf = True
direct_scf_tol = 1e-13
max_memory 327680 MB (current use 1252 MB)


******** PBC SCF flags ********
N kpts = 8
kpts = [[0.         0.         0.        ]
 [0.         0.         0.46609264]
 [0.         0.46609264 0.        ]
 [0.         0.46609264 0.46609264]
 [0.46609264 0.         0.        ]
 [0.46609264 0.         0.46609264]
 [0.46609264 0.46609264 0.        ]
 [0.46609264 0.46609264 0.46609264]]
Exchange divergence treatment (exxdiv) = None
DF object = <gpu4pyscf.pbc.df.fft.FFTDF object at 0x7f8e79103740>
cond(S) = [38043742.00768211  2734915.54559409  2734915.5456125    624894.20421697
  2734915.54550449   624894.20426318   624894.20423157   209084.24478848]
Set gradient conv threshold to 0.001
    CPU time for vj and vk                                               5.29 sec, wall time      5.38 sec, GPU time   5367.92 ms
E1 = (15.52031957526588+3.632016603819532e-17j)  E_coul = (-8.698190932832071+1.431752766586628e-16j)
init E= -44.3263879400631
    CPU time for SCF initialization                                      9.62 sec, wall time      5.60 sec, GPU time   5604.82 ms
HOMO = 0.663234716869  LUMO = 0.823039087091
    CPU time for vj and vk                                               1.22 sec, wall time      1.32 sec, GPU time   1323.18 ms
E1 = (16.229086399506958+3.277119252352395e-17j)  E_coul = (-5.770472719554554+1.3363980103874953e-16j)
    CPU time for cycle=1                                                 1.26 sec, wall time      1.37 sec, GPU time   1369.14 ms
cycle= 1 E= -40.6899029025445  delta_E= 3.64  |g|=  1.2  |ddm|=   52
HOMO = 0.592931484641  LUMO = 0.868444774958
    CPU time for vj and vk                                               1.21 sec, wall time      1.22 sec, GPU time   1224.07 ms
E1 = (16.095084702120513-1.5214376769065886e-16j)  E_coul = (-5.707169726017235+1.4167418377811188e-16j)
    CPU time for cycle=2                                                 1.26 sec, wall time      1.27 sec, GPU time   1273.83 ms
cycle= 2 E= -40.7606016063936  delta_E= -0.0707  |g|= 0.185  |ddm|= 55.4
HOMO = 0.585651782646  LUMO = 0.880317632254
    CPU time for vj and vk                                               1.21 sec, wall time      1.23 sec, GPU time   1226.23 ms
E1 = (16.098884306466697-2.346938052215492e-16j)  E_coul = (-5.712307709828826+1.441389855998232e-16j)
    CPU time for cycle=3                                                 1.24 sec, wall time      1.25 sec, GPU time   1252.12 ms
cycle= 3 E= -40.761939985859  delta_E= -0.00134  |g|= 0.00752  |ddm|= 17.2
HOMO = 0.58510427204  LUMO = 0.879853936474
    CPU time for vj and vk                                               1.21 sec, wall time      1.22 sec, GPU time   1224.67 ms
E1 = (16.09778451110141-2.319536971869483e-16j)  E_coul = (-5.71120952362558+1.408324749627144e-16j)
    CPU time for cycle=4                                                 1.24 sec, wall time      1.25 sec, GPU time   1250.87 ms
cycle= 4 E= -40.7619415950211  delta_E= -1.61e-06  |g|= 0.000625  |ddm|= 0.47
HOMO = 0.585118577059  LUMO = 0.879876355668
    CPU time for vj and vk                                               1.21 sec, wall time      1.22 sec, GPU time   1222.70 ms
E1 = (16.097892981419207-2.3219839094463214e-16j)  E_coul = (-5.711318007373899+1.392490701241961e-16j)
    CPU time for cycle=5                                                 1.23 sec, wall time      1.25 sec, GPU time   1248.90 ms
cycle= 5 E= -40.7619416084516  delta_E= -1.34e-08  |g|= 2.14e-05  |ddm|= 0.0551
    CPU time for SCF                                                    15.93 sec, wall time     12.08 sec, GPU time  12083.85 ms
converged SCF energy = -40.7619416084516


******** <class 'gpu4pyscf.pbc.scf.khf.KRHF'> ********
method = KRHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'gpu4pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-06
SCF conv_tol_grad = None
SCF max_cycles = 10
direct_scf = True
direct_scf_tol = 1e-13
max_memory 327680 MB (current use 1448 MB)


******** PBC SCF flags ********
N kpts = 8
kpts = [[0.         0.         0.        ]
 [0.         0.         0.46609264]
 [0.         0.46609264 0.        ]
 [0.         0.46609264 0.46609264]
 [0.46609264 0.         0.        ]
 [0.46609264 0.         0.46609264]
 [0.46609264 0.46609264 0.        ]
 [0.46609264 0.46609264 0.46609264]]
Exchange divergence treatment (exxdiv) = None
DF object = <fftdf.OccRI object at 0x7f8c32049520>
cond(S) = [38043742.00768211  2734915.54559409  2734915.5456125    624894.20421697
  2734915.54550449   624894.20426318   624894.20423157   209084.24478848]
Set gradient conv threshold to 0.001
mem_avail: 78.066 GB, total_mem: 0.020 GB, used_mem: 0.008 GB,mem_limt: 71.270 GB
k = 0, kpt = [0. 0. 0.]
kpt = [0. 0. 0.], g0 = 0, g1 = 20000
kpt = [0. 0. 0.], g0 = 20000, g1 = 35937
k = 1, kpt = [0.         0.         0.46609264]
kpt = [0.         0.         0.46609264], g0 = 0, g1 = 20000
kpt = [0.         0.         0.46609264], g0 = 20000, g1 = 35937
k = 2, kpt = [0.         0.46609264 0.        ]
kpt = [0.         0.46609264 0.        ], g0 = 0, g1 = 20000
kpt = [0.         0.46609264 0.        ], g0 = 20000, g1 = 35937
k = 3, kpt = [0.         0.46609264 0.46609264]
kpt = [0.         0.46609264 0.46609264], g0 = 0, g1 = 20000
kpt = [0.         0.46609264 0.46609264], g0 = 20000, g1 = 35937
k = 4, kpt = [0.46609264 0.         0.        ]
kpt = [0.46609264 0.         0.        ], g0 = 0, g1 = 20000
kpt = [0.46609264 0.         0.        ], g0 = 20000, g1 = 35937
k = 5, kpt = [0.46609264 0.         0.46609264]
kpt = [0.46609264 0.         0.46609264], g0 = 0, g1 = 20000
kpt = [0.46609264 0.         0.46609264], g0 = 20000, g1 = 35937
k = 6, kpt = [0.46609264 0.46609264 0.        ]
kpt = [0.46609264 0.46609264 0.        ], g0 = 0, g1 = 20000
kpt = [0.46609264 0.46609264 0.        ], g0 = 20000, g1 = 35937
k = 7, kpt = [0.46609264 0.46609264 0.46609264]
kpt = [0.46609264 0.46609264 0.46609264], g0 = 0, g1 = 20000
kpt = [0.46609264 0.46609264 0.46609264], g0 = 20000, g1 = 35937


******** <class 'fftdf.OccRI'> ********
mesh = [33 33 33] (35937 PWs)
nkpts = 8
nao = 104, nocc = 16, blksize = 4
rhoR memory usage = 3.68e-02 GB
ao_kpts memory usage = 4.78e-01 GB
    CPU time for vj and vk                                               0.04 sec, wall time      0.04 sec, GPU time     26.44 ms
E1 = (15.530259654743382+3.7259798148770893e-17j)  E_coul = (2.5403951656325887+2.6879038687583863e-34j)
init E= -33.0778617621209
    CPU time for SCF initialization                                      4.49 sec, wall time      0.25 sec, GPU time    254.38 ms
HOMO = 0.936932591713  LUMO = 0.936932610074

WARN: HOMO 0.936932591713 == LUMO 0.936932610074

    CPU time for vj and vk                                               0.70 sec, wall time      0.79 sec, GPU time    789.57 ms
E1 = (5.7369758419263235-7.993605777301127e-14j)  E_coul = (-4.7348310777799725+1.5276668818842154e-13j)
    CPU time for cycle=1                                                 0.73 sec, wall time      0.81 sec, GPU time    813.41 ms
cycle= 1 E= -50.1463718183506  delta_E= -17.1  |g|= 2.62  |ddm|= 6.65e+04
HOMO = 0.587614942196  LUMO = 0.942305233699
    CPU time for vj and vk                                               0.68 sec, wall time      0.69 sec, GPU time    691.99 ms
E1 = (5.632677496796532-4.707345624410664e-14j)  E_coul = (-4.779982533646148-6.705747068735946e-14j)
    CPU time for cycle=2                                                 0.73 sec, wall time      0.73 sec, GPU time    734.39 ms
cycle= 2 E= -50.2958216193465  delta_E= -0.149  |g|= 0.491  |ddm|= 7.56e+03
HOMO = 0.583812646948  LUMO = 0.958896297311
    CPU time for vj and vk                                               0.69 sec, wall time      0.70 sec, GPU time    695.26 ms
E1 = (5.612204689884493-2.6645352591003757e-14j)  E_coul = (-4.767637166630266-3.206324095117452e-13j)
    CPU time for cycle=3                                                 0.71 sec, wall time      0.72 sec, GPU time    721.00 ms
cycle= 3 E= -50.3039490592427  delta_E= -0.00813  |g|= 0.236  |ddm|=  843
HOMO = 0.545369415468  LUMO = 0.546154642098

WARN: HOMO 0.545369415468 == LUMO 0.546154642098

    CPU time for vj and vk                                               0.69 sec, wall time      0.71 sec, GPU time    712.48 ms
E1 = (9.67543674967601-2.1827872842550278e-11j)  E_coul = (-4.560263531519013+3.1650415621697903e-10j)
    CPU time for cycle=4                                                 0.72 sec, wall time      0.74 sec, GPU time    738.48 ms
cycle= 4 E= -46.0333433643399  delta_E= 4.27  |g|= 8.86  |ddm|= 7.78e+06
HOMO = 0.579169981935  LUMO = 0.588901641824
    CPU time for vj and vk                                               0.69 sec, wall time      0.73 sec, GPU time    732.04 ms
E1 = (6.7800036281059874-3.637978807091713e-12j)  E_coul = (-4.699448583683079-4.501998773775995e-11j)
    CPU time for cycle=5                                                 0.72 sec, wall time      0.76 sec, GPU time    757.88 ms
cycle= 5 E= -49.067961538074  delta_E= -3.03  |g|= 3.56  |ddm|= 5.77e+06
HOMO = 0.581929448511  LUMO = 0.584433206859
    CPU time for vj and vk                                               0.69 sec, wall time      0.70 sec, GPU time    695.76 ms
E1 = (6.688564714857421-2.7284841053187847e-12j)  E_coul = (-4.717312232326549-1.2960299500264227e-11j)
    CPU time for cycle=6                                                 0.71 sec, wall time      0.72 sec, GPU time    721.79 ms
cycle= 6 E= -49.177264099966  delta_E= -0.109  |g|= 1.59  |ddm|= 1.62e+06
HOMO = 0.582527064168  LUMO = 0.58804239318
    CPU time for vj and vk                                               0.69 sec, wall time      0.70 sec, GPU time    698.58 ms
E1 = (6.682138139219205-1.8189894035458565e-12j)  E_coul = (-4.719248202036397-3.637978807091713e-11j)
    CPU time for cycle=7                                                 0.72 sec, wall time      0.72 sec, GPU time    724.89 ms
cycle= 7 E= -49.1856266453141  delta_E= -0.00836  |g|= 1.43  |ddm|= 1.3e+06
HOMO = 0.582253306817  LUMO = 0.589520646073
    CPU time for vj and vk                                               0.69 sec, wall time      0.70 sec, GPU time    695.10 ms
E1 = (6.682985818062662-9.094947017729282e-12j)  E_coul = (-4.719249513394061-5.002220859751105e-12j)
    CPU time for cycle=8                                                 0.71 sec, wall time      0.72 sec, GPU time    721.61 ms
cycle= 8 E= -49.1847802778283  delta_E= 0.000846  |g|= 1.52  |ddm|= 1.09e+06
HOMO = 0.582496684979  LUMO = 0.589671513331
    CPU time for vj and vk                                               0.69 sec, wall time      0.70 sec, GPU time    697.12 ms
E1 = (6.684754103417617+1.8189894035458565e-12j)  E_coul = (-4.718163593365489-2.2282620193436742e-11j)
    CPU time for cycle=9                                                 0.71 sec, wall time      0.72 sec, GPU time    723.57 ms
cycle= 9 E= -49.1819260724448  delta_E= 0.00285  |g|= 1.47  |ddm|= 1.1e+06
HOMO = 0.586005150128  LUMO = 0.598600925164
    CPU time for vj and vk                                               0.69 sec, wall time      0.70 sec, GPU time    695.20 ms
E1 = (6.691729951169691+7.275957614183426e-12j)  E_coul = (-4.716137929426623-5.547917680814862e-11j)
    CPU time for cycle=10                                                0.71 sec, wall time      0.72 sec, GPU time    721.92 ms
cycle= 10 E= -49.1729245607538  delta_E= 0.009  |g|=  1.6  |ddm|= 3.23e+06

WARN: SCF failed to converge

    CPU time for SCF                                                    11.69 sec, wall time      7.66 sec, GPU time   7664.37 ms
SCF not converged.
SCF energy = -49.1729245607538
ene_ref =   -40.761942
ene_sol =   -49.172925
error   = 8.41e+00
done
End time = Tue Nov 18 06:27:38 PM PST 2025
