SLURMD_NODENAME = hpc-33-16
Start time = Fri Nov 21 11:07:03 PM PST 2025
CUDA_VISIBLE_DEVICES = 0
OMP_NUM_THREADS = 32
MKL_NUM_THREADS = 4
OPENBLAS_NUM_THREADS = 4
PYSCF_MAX_MEMORY = 327680
TMPDIR = /resnick/scratch/yangjunjie//gpu4pyscf-occri/55145962/
PYSCF_TMPDIR = /resnick/scratch/yangjunjie//gpu4pyscf-occri/55145962/
Using GPU device 0
Free memory: 78.68 GB
Total memory: 79.19 GB
poscar_path: /resnick/groups/changroup/members/junjiey/occri/packages/cuprate_parent_state_data/01_crystal_geometry/Hg-1212/Hg-1212-AFM.vasp
Discarded 42 diffused primitive functions, 0 contracted functions
#INFO: **** input file is /resnick/groups/changroup/members/junjiey/occri/occri-main/work/hg1212-afm-3/main.py ****
import cupy as cp

device = cp.cuda.Device()
print(f"Using GPU device {device.id}")

mem_info = cp.cuda.runtime.memGetInfo()
print(f"Free memory: {mem_info[0] / (1024**3):.2f} GB")
print(f"Total memory: {mem_info[1] / (1024**3):.2f} GB")

import pyscf, gpu4pyscf
from pyscf.pbc import gto
import gpu4pyscf.pbc

import sys, pathlib
poscar_path = pathlib.Path("/resnick/groups/changroup/members/junjiey/occri/packages/")
poscar_path = poscar_path / "cuprate_parent_state_data/01_crystal_geometry/Hg-1212/Hg-1212-AFM.vasp"
assert poscar_path.exists()

path = str(poscar_path)
print(f"poscar_path: {path}")

from libdmet.utils.iotools import read_poscar
pcell = read_poscar(path)
pcell.basis = 'gth-dzvp-molopt-sr'
pcell.pseudo = "gth-hf-rev"
pcell.ke_cutoff = 200
pcell.exp_to_discard = 0.1
pcell.verbose = 5
pcell.build()

kpts = pcell.make_kpts([2, 2, 1])

alph_label = ["0 Cu 3dx2-y2"]
beta_label = ["1 Cu 3dx2-y2"]
alph_ix = pcell.search_ao_label(alph_label)
beta_ix = pcell.search_ao_label(beta_label)

from gpu4pyscf.pbc.scf import KRHF, KUHF
mf = KUHF(pcell, kpts)
mf.verbose = 4
mf.conv_tol = 1e-6
mf.max_cycle = 10
mf.diis_space = 4
mf.exxdiv = None
dm0 = mf.get_init_guess(key='minao')

dm0[0, :, alph_ix, alph_ix] *= 2.0
dm0[1, :, beta_ix, beta_ix] *= 2.0
dm0[0, :, beta_ix, beta_ix] *= 0.0
dm0[1, :, alph_ix, alph_ix] *= 0.0

from fftdf import FFTDF
mf.with_df = FFTDF(pcell, kpts, with_occri=True, use_gpu=True)
mf.with_df.blksize = 32
mf.with_df._mo_is_missing = None

mf.kernel(dm0)
ene_sol = mf.e_tot

ene_sol = mf.e_tot
dm0 = mf.make_rdm1()

from gpu4pyscf.pbc.df.fft import FFTDF
mf.with_df = FFTDF(pcell, kpts)
mf.kernel(dm0)
ene_ref = mf.e_tot

print("ene_ref = %12.6f" % ene_ref)
print("ene_sol = %12.6f" % ene_sol)
print("error   = %6.2e" % abs(ene_ref - ene_sol))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-33-16.cm.cluster', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed Apr 10 10:29:16 EDT 2024', machine='x86_64')  Threads 32
Python 3.12.12 | packaged by Anaconda, Inc. | (main, Oct 21 2025, 20:16:04) [GCC 11.2.0]
numpy 2.2.6  scipy 1.16.3  h5py 3.15.1
Date: Fri Nov 21 23:07:07 2025
PySCF version 2.8.0
PySCF path  /home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/pyscf/__init__.py
CUDA Environment
    CuPy 13.4.1
    CUDA Path /home/junjiey/anaconda3/envs/gpu4pyscf-occri
    CUDA Build Version 12080
    CUDA Driver Version 12080
    CUDA Runtime Version 12080
CUDA toolkit
    cuSolver (11, 7, 2)
    cuBLAS 120804
    cuTENSOR 20200
Device info
    Device name b'NVIDIA H100 80GB HBM3'
    Device global memory 79.19 GB
    CuPy memory fraction 0.9
    Num. Devices 1
GPU4PySCF 1.4.3
GPU4PySCF path  /home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf

[ENV] PYSCF_TMPDIR /resnick/scratch/yangjunjie//gpu4pyscf-occri/55145962/
[ENV] PYSCF_MAX_MEMORY 327680
[CONFIG] conf_file None
[INPUT] verbose = 5
[INPUT] max_memory = 327680 
[INPUT] num. atoms = 24
[INPUT] num. electrons = 232
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = A
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cu1    1.931500000000   0.000000000000   4.789610160000 AA    3.650006009597   0.000000000000   9.051051445834 Bohr   0.0
[INPUT]  2 Cu2    5.794500000000  -0.000000000000   4.789610160000 AA   10.950018028792  -0.000000000000   9.051051445834 Bohr   0.0
[INPUT]  3 O1     3.863000000000  -3.863000000000   4.780721700000 AA    7.300012019195  -7.300012019195   9.034254690765 Bohr   0.0
[INPUT]  4 O1     3.863000000000   0.000000000000   4.780721700000 AA    7.300012019195   0.000000000000   9.034254690765 Bohr   0.0
[INPUT]  5 O1     1.931500000000   1.931500000000   4.780721700000 AA    3.650006009597   3.650006009597   9.034254690765 Bohr   0.0
[INPUT]  6 O1     5.794500000000   1.931500000000   4.780721700000 AA   10.950018028792   3.650006009597   9.034254690765 Bohr   0.0
[INPUT]  7 O2     1.931500000000   0.000000000000   1.965619440000 AA    3.650006009597   0.000000000000   3.714482406721 Bohr   0.0
[INPUT]  8 O2     5.794500000000  -0.000000000000   1.965619440000 AA   10.950018028792  -0.000000000000   3.714482406721 Bohr   0.0
[INPUT]  9 Cu3    1.931500000000   0.000000000000   7.908189840000 AA    3.650006009597   0.000000000000  14.944312938668 Bohr   0.0
[INPUT] 10 Cu4    5.794500000000  -0.000000000000   7.908189840000 AA   10.950018028792  -0.000000000000  14.944312938668 Bohr   0.0
[INPUT] 11 O3     3.863000000000  -3.863000000000   7.917078300000 AA    7.300012019195  -7.300012019195  14.961109693737 Bohr   0.0
[INPUT] 12 O3     3.863000000000   0.000000000000   7.917078300000 AA    7.300012019195   0.000000000000  14.961109693737 Bohr   0.0
[INPUT] 13 O3     1.931500000000   1.931500000000   7.917078300000 AA    3.650006009597   3.650006009597  14.961109693737 Bohr   0.0
[INPUT] 14 O3     5.794500000000   1.931500000000   7.917078300000 AA   10.950018028792   3.650006009597  14.961109693737 Bohr   0.0
[INPUT] 15 O4     1.931500000000   0.000000000000  10.732180560000 AA    3.650006009597   0.000000000000  20.280881977781 Bohr   0.0
[INPUT] 16 O4     5.794500000000  -0.000000000000  10.732180560000 AA   10.950018028792  -0.000000000000  20.280881977781 Bohr   0.0
[INPUT] 17 Hg     1.931500000000   0.000000000000   0.000000000000 AA    3.650006009597   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] 18 Hg     5.794500000000  -0.000000000000  12.697800000000 AA   10.950018028792  -0.000000000000  23.995364384502 Bohr   0.0
[INPUT] 19 Ba     3.863000000000   1.931500000000   2.848116540000 AA    7.300012019195   3.650006009597   5.382160231444 Bohr   0.0
[INPUT] 20 Ba     3.863000000000  -1.931500000000   2.848116540000 AA    7.300012019195  -3.650006009597   5.382160231444 Bohr   0.0
[INPUT] 21 Ba     3.863000000000   1.931500000000   9.849683460000 AA    7.300012019195   3.650006009597  18.613204153058 Bohr   0.0
[INPUT] 22 Ba     3.863000000000  -1.931500000000   9.849683460000 AA    7.300012019195  -3.650006009597  18.613204153058 Bohr   0.0
[INPUT] 23 Ca     3.863000000000   1.931500000000   6.348900000000 AA    7.300012019195   3.650006009597  11.997682192251 Bohr   0.0
[INPUT] 24 Ca     3.863000000000  -1.931500000000   6.348900000000 AA    7.300012019195  -3.650006009597  11.997682192251 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Cu2
[INPUT] 0    0    [5    /2   ]  5.80405115073     0.02091810039 0.045720931893
                                2.94777759308     -0.106208582202 -0.094026024883
                                1.27162120797     0.307397740339 -0.110623536813
                                0.51717376786     0.240805274553 -0.742218346329
                                0.198006620331    -0.798718095004 2.20810737271
[INPUT] 1    0    [5    /2   ]  5.80405115073     -0.004381592772 -0.021109803873
                                2.94777759308     0.017185613995 0.020960301873
                                1.27162120797     -0.089805629814 0.233442747472
                                0.51717376786     0.05441512666 0.369266430953
                                0.198006620331    0.446326740476 -1.4050671297
[INPUT] 2    0    [5    /2   ]  5.80405115073     0.275442696345 -0.101811263028
                                2.94777759308     0.351705110927 -0.207670618594
                                1.27162120797     0.33163596964 -0.224161904198
                                0.51717376786     0.259386540456 0.176105738988
                                0.198006620331    0.151105835782 0.210534119173
[INPUT] 3    0    [5    /1   ]  5.80405115073     -0.016523760157
                                2.94777759308     0.055142365254
                                1.27162120797     -0.28665608976
                                0.51717376786     -0.502349311598
                                0.198006620331    -0.508940020577
[INPUT] Cu1
[INPUT] 0    0    [5    /2   ]  5.80405115073     0.02091810039 0.045720931893
                                2.94777759308     -0.106208582202 -0.094026024883
                                1.27162120797     0.307397740339 -0.110623536813
                                0.51717376786     0.240805274553 -0.742218346329
                                0.198006620331    -0.798718095004 2.20810737271
[INPUT] 1    0    [5    /2   ]  5.80405115073     -0.004381592772 -0.021109803873
                                2.94777759308     0.017185613995 0.020960301873
                                1.27162120797     -0.089805629814 0.233442747472
                                0.51717376786     0.05441512666 0.369266430953
                                0.198006620331    0.446326740476 -1.4050671297
[INPUT] 2    0    [5    /2   ]  5.80405115073     0.275442696345 -0.101811263028
                                2.94777759308     0.351705110927 -0.207670618594
                                1.27162120797     0.33163596964 -0.224161904198
                                0.51717376786     0.259386540456 0.176105738988
                                0.198006620331    0.151105835782 0.210534119173
[INPUT] 3    0    [5    /1   ]  5.80405115073     -0.016523760157
                                2.94777759308     0.055142365254
                                1.27162120797     -0.28665608976
                                0.51717376786     -0.502349311598
                                0.198006620331    -0.508940020577
[INPUT] O2
[INPUT] 0    0    [5    /2   ]  10.3892280183     0.1262407229 0.0692157979
                                3.84962107201     0.1399337043 0.1156345389
                                1.38840118874     -0.4343482317 -0.3228397194
                                0.496955043655    -0.8527917909 -0.0959440166
                                0.16249161504     -0.2423515378 1.1028303487
[INPUT] 1    0    [5    /2   ]  10.3892280183     -0.0613020372 -0.0268627011
                                3.84962107201     -0.1900875117 -0.006283021
                                1.38840118874     -0.3777269828 -0.2248391878
                                0.496955043655    -0.454266086 0.3803246586
                                0.16249161504     -0.257388983 1.0541029199
[INPUT] 2    0    [5    /1   ]  10.3892280183     0.0298452275
                                3.84962107201     0.0609397339
                                1.38840118874     0.7323215801
                                0.496955043655    0.8935649184
                                0.16249161504     0.1529541887
[INPUT] Cu4
[INPUT] 0    0    [5    /2   ]  5.80405115073     0.02091810039 0.045720931893
                                2.94777759308     -0.106208582202 -0.094026024883
                                1.27162120797     0.307397740339 -0.110623536813
                                0.51717376786     0.240805274553 -0.742218346329
                                0.198006620331    -0.798718095004 2.20810737271
[INPUT] 1    0    [5    /2   ]  5.80405115073     -0.004381592772 -0.021109803873
                                2.94777759308     0.017185613995 0.020960301873
                                1.27162120797     -0.089805629814 0.233442747472
                                0.51717376786     0.05441512666 0.369266430953
                                0.198006620331    0.446326740476 -1.4050671297
[INPUT] 2    0    [5    /2   ]  5.80405115073     0.275442696345 -0.101811263028
                                2.94777759308     0.351705110927 -0.207670618594
                                1.27162120797     0.33163596964 -0.224161904198
                                0.51717376786     0.259386540456 0.176105738988
                                0.198006620331    0.151105835782 0.210534119173
[INPUT] 3    0    [5    /1   ]  5.80405115073     -0.016523760157
                                2.94777759308     0.055142365254
                                1.27162120797     -0.28665608976
                                0.51717376786     -0.502349311598
                                0.198006620331    -0.508940020577
[INPUT] O3
[INPUT] 0    0    [5    /2   ]  10.3892280183     0.1262407229 0.0692157979
                                3.84962107201     0.1399337043 0.1156345389
                                1.38840118874     -0.4343482317 -0.3228397194
                                0.496955043655    -0.8527917909 -0.0959440166
                                0.16249161504     -0.2423515378 1.1028303487
[INPUT] 1    0    [5    /2   ]  10.3892280183     -0.0613020372 -0.0268627011
                                3.84962107201     -0.1900875117 -0.006283021
                                1.38840118874     -0.3777269828 -0.2248391878
                                0.496955043655    -0.454266086 0.3803246586
                                0.16249161504     -0.257388983 1.0541029199
[INPUT] 2    0    [5    /1   ]  10.3892280183     0.0298452275
                                3.84962107201     0.0609397339
                                1.38840118874     0.7323215801
                                0.496955043655    0.8935649184
                                0.16249161504     0.1529541887
[INPUT] Hg
[INPUT] 0    0    [5    /2   ]  3.03151710973     -0.000773276442 0.142001377433
                                1.99994975008     -0.127545432316 -0.280482979589
                                0.968505371291    0.467348942725 0.098625459472
                                0.443215909283    0.041435964338 -1.22346269605
                                0.197907885691    -0.613050351354 3.05337233597
[INPUT] 1    0    [5    /2   ]  3.03151710973     -0.035104188311 -0.090931506623
                                1.99994975008     0.112459425109 0.162444892253
                                0.968505371291    -0.270433349168 0.029548333852
                                0.443215909283    0.012885629971 0.581078127814
                                0.197907885691    0.562923305773 -2.00421412613
[INPUT] 2    0    [5    /2   ]  3.03151710973     -0.05151943161 0.008323885654
                                1.99994975008     0.245745995267 -0.053441689967
                                0.968505371291    0.344642941759 -0.16587724051
                                0.443215909283    0.274191104401 0.080323576326
                                0.197907885691    0.133463525187 -0.144762593434
[INPUT] 3    0    [5    /1   ]  3.03151710973     0.001599032324
                                1.99994975008     0.043884187965
                                0.968505371291    -0.177253996973
                                0.443215909283    -0.478266521156
                                0.197907885691    -0.61379541184
[INPUT] Ba
[INPUT] 0    0    [5    /3   ]  1.09910738739     -0.265977603953 0.133167313532 0.290876128104
                                1.04241561143     -0.548867124949 0.303553076384 -0.457720153751
                                0.9238155833      0.534778251294 -0.187596947384 0.955681723101
                                0.40951518718     0.587584269233 -0.829784858376 -3.83974646531
                                0.166000524554    0.112796348364 0.080177822791 3.55910474784
[INPUT] 1    0    [5    /2   ]  1.09910738739     -0.076120521522 0.156054210447
                                1.04241561143     0.581707053986 0.034898462239
                                0.9238155833      -0.513377720928 -0.112603657198
                                0.40951518718     -0.199996660495 -0.398760799348
                                0.166000524554    -0.129413972483 0.013035859628
[INPUT] 2    0    [5    /1   ]  1.09910738739     0.457091203328
                                1.04241561143     -0.05188439794
                                0.9238155833      -0.325084641003
                                0.40951518718     -1.10383146659
                                0.166000524554    -1.30799715534
[INPUT] O1
[INPUT] 0    0    [5    /2   ]  10.3892280183     0.1262407229 0.0692157979
                                3.84962107201     0.1399337043 0.1156345389
                                1.38840118874     -0.4343482317 -0.3228397194
                                0.496955043655    -0.8527917909 -0.0959440166
                                0.16249161504     -0.2423515378 1.1028303487
[INPUT] 1    0    [5    /2   ]  10.3892280183     -0.0613020372 -0.0268627011
                                3.84962107201     -0.1900875117 -0.006283021
                                1.38840118874     -0.3777269828 -0.2248391878
                                0.496955043655    -0.454266086 0.3803246586
                                0.16249161504     -0.257388983 1.0541029199
[INPUT] 2    0    [5    /1   ]  10.3892280183     0.0298452275
                                3.84962107201     0.0609397339
                                1.38840118874     0.7323215801
                                0.496955043655    0.8935649184
                                0.16249161504     0.1529541887
[INPUT] Cu3
[INPUT] 0    0    [5    /2   ]  5.80405115073     0.02091810039 0.045720931893
                                2.94777759308     -0.106208582202 -0.094026024883
                                1.27162120797     0.307397740339 -0.110623536813
                                0.51717376786     0.240805274553 -0.742218346329
                                0.198006620331    -0.798718095004 2.20810737271
[INPUT] 1    0    [5    /2   ]  5.80405115073     -0.004381592772 -0.021109803873
                                2.94777759308     0.017185613995 0.020960301873
                                1.27162120797     -0.089805629814 0.233442747472
                                0.51717376786     0.05441512666 0.369266430953
                                0.198006620331    0.446326740476 -1.4050671297
[INPUT] 2    0    [5    /2   ]  5.80405115073     0.275442696345 -0.101811263028
                                2.94777759308     0.351705110927 -0.207670618594
                                1.27162120797     0.33163596964 -0.224161904198
                                0.51717376786     0.259386540456 0.176105738988
                                0.198006620331    0.151105835782 0.210534119173
[INPUT] 3    0    [5    /1   ]  5.80405115073     -0.016523760157
                                2.94777759308     0.055142365254
                                1.27162120797     -0.28665608976
                                0.51717376786     -0.502349311598
                                0.198006620331    -0.508940020577
[INPUT] O4
[INPUT] 0    0    [5    /2   ]  10.3892280183     0.1262407229 0.0692157979
                                3.84962107201     0.1399337043 0.1156345389
                                1.38840118874     -0.4343482317 -0.3228397194
                                0.496955043655    -0.8527917909 -0.0959440166
                                0.16249161504     -0.2423515378 1.1028303487
[INPUT] 1    0    [5    /2   ]  10.3892280183     -0.0613020372 -0.0268627011
                                3.84962107201     -0.1900875117 -0.006283021
                                1.38840118874     -0.3777269828 -0.2248391878
                                0.496955043655    -0.454266086 0.3803246586
                                0.16249161504     -0.257388983 1.0541029199
[INPUT] 2    0    [5    /1   ]  10.3892280183     0.0298452275
                                3.84962107201     0.0609397339
                                1.38840118874     0.7323215801
                                0.496955043655    0.8935649184
                                0.16249161504     0.1529541887
[INPUT] Ca
[INPUT] 0    0    [5    /3   ]  5.28498559656     -0.416182629697 -0.083912217567 -0.208574685974
                                4.09175222912     0.887610504052 0.216895453968 0.314510703283
                                1.42952032176     -0.323549926958 -0.096935550443 -0.601923136001
                                0.614375507986    -0.908395199325 -0.502206578258 2.85361497501
                                0.242970577562    -0.208971576432 -0.096821746914 -3.04328735203
[INPUT] 1    0    [5    /2   ]  5.28498559656     0.064960038145 0.026515439739
                                4.09175222912     0.014546526081 -0.02899796995
                                1.42952032176     -0.466720491908 -0.07324385119
                                0.614375507986    -0.634030899528 -0.218228118923
                                0.242970577562    -0.251681593814 0.144907690867
[INPUT] 2    0    [5    /1   ]  5.28498559656     -0.06663075251
                                4.09175222912     0.197842850864
                                1.42952032176     0.45836517156
                                0.614375507986    0.372585742208
                                0.242970577562    0.820156666086

Ewald components = 166.684900117912, -873.783650064679, 247.96500671341
nuclear repulsion = -459.133743233357
number of shells = 78
number of NR pGTOs = 1290
number of NR cGTOs = 390
basis = gth-dzvp-molopt-sr
ecp = {}
CPU time:         1.86
lattice vectors  a1 [7.300012019, -7.300012019, 0.000000000]
                 a2 [7.300012019, 7.300012019, 0.000000000]
                 a3 [0.000000000, 0.000000000, 23.995364385]
dimension = 3
low_dim_ft_type = None
Cell volume = 2557.43
exp_to_discard = 0.1
rcut = 19.589025924348242 (nimgs = [2 2 1])
lattice sum = 139 cells
precision = 1e-08
pseudo = gth-hf-rev
ke_cutoff = 200
    = [ 67  67 155] mesh (695795 PWs)
Density of valence part of ANO basis will be used as initial guess for Cu1
Density of valence part of ANO basis will be used as initial guess for Cu2
Density of valence part of ANO basis will be used as initial guess for Cu3
Density of valence part of ANO basis will be used as initial guess for Cu4
Density of valence part of ANO basis will be used as initial guess for Ba
Density of valence part of ANO basis will be used as initial guess for Ca


******** <class 'gpu4pyscf.pbc.scf.kuhf.KUHF'> ********
method = KUHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'gpu4pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 4
diis_damp = 0
SCF conv_tol = 1e-06
SCF conv_tol_grad = None
SCF max_cycles = 10
direct_scf = True
direct_scf_tol = 1e-13
max_memory 327680 MB (current use 1371 MB)


******** PBC SCF flags ********
N kpts = 4
Exchange divergence treatment (exxdiv) = None
DF object = <fftdf.OccRI object at 0x7f26eb92b200>
number of electrons per cell  alpha = 464 beta = 464
Set gradient conv threshold to 0.001


******** <class 'fftdf.OccRI'> ********
mesh = [ 67  67 155] (695795 PWs)
nkpts = 4
nao = 390, nocc = 116, blksize = 32
_mo_is_missing = None
init E= -992.007723056646
cycle= 1 E= -857.013716995619  delta_E=  135  |g|= 35.4  |ddm|=  155
cycle= 2 E= 3627.61855531411  delta_E= 4.48e+03  |g|= 58.4  |ddm|= 1.75e+03
cycle= 3 E= 313.664180535782  delta_E= -3.31e+03  |g|= 49.8  |ddm|= 1.75e+03
cycle= 4 E= -434.637168273012  delta_E= -748  |g|= 52.9  |ddm|= 79.3
cycle= 5 E= -871.817192214194  delta_E= -437  |g|= 33.3  |ddm|= 29.2
cycle= 6 E= -401.60760450579  delta_E=  470  |g|= 56.1  |ddm|= 32.6
cycle= 7 E= 3619.71666238462  delta_E= 4.02e+03  |g|= 64.2  |ddm|= 1.62e+03
cycle= 8 E= 174.276258157812  delta_E= -3.45e+03  |g|= 64.2  |ddm|= 1.62e+03
cycle= 9 E= -258.072176455657  delta_E= -432  |g|= 65.2  |ddm|= 54.6
cycle= 10 E= 59.6075114229062  delta_E=  318  |g|=   60  |ddm|= 66.9

WARN: SCF failed to converge

SCF not converged.
SCF energy = 59.6075114229062


******** <class 'gpu4pyscf.pbc.scf.kuhf.KUHF'> ********
method = KUHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'gpu4pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 4
diis_damp = 0
SCF conv_tol = 1e-06
SCF conv_tol_grad = None
SCF max_cycles = 10
direct_scf = True
direct_scf_tol = 1e-13
max_memory 327680 MB (current use 2020 MB)


******** PBC SCF flags ********
N kpts = 4
Exchange divergence treatment (exxdiv) = None
DF object = <gpu4pyscf.pbc.df.fft.FFTDF object at 0x7f29200d0cb0>
number of electrons per cell  alpha = 464 beta = 464
Set gradient conv threshold to 0.001
Traceback (most recent call last):
  File "/resnick/groups/changroup/members/junjiey/occri/occri-main/work/hg1212-afm-3/main.py", line 65, in <module>
    mf.kernel(dm0)
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/scf/hf.py", line 344, in scf
    _kernel(mf, mf.conv_tol, mf.conv_tol_grad,
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/scf/hf.py", line 213, in _kernel
    vhf = mf.get_veff(mol, dm)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/pbc/scf/kuhf.py", line 254, in get_veff
    vj, vk = self.get_jk(cell, dm_kpts, hermi, kpts, kpts_band)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/pbc/scf/khf.py", line 331, in get_jk
    vj, vk = self.with_df.get_jk(
             ^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/pbc/df/fft.py", line 294, in get_jk
    vk = fft_jk.get_k_kpts(self, dm, hermi, kpts, kpts_band, exxdiv)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/pbc/df/fft_jk.py", line 187, in get_k_kpts
    rho1 = contract('ig,jg->ijg', ao1T[p0:p1].conj()*expmikr, ao2T)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/lib/cutensor.py", line 172, in contract
    return contraction(pattern, a, b, alpha, beta, out=out)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/lib/cutensor.py", line 105, in contraction
    out = cupy.empty([shape[k] for k in str_c], order='C', dtype=dtype)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/cupy/_creation/basic.py", line 32, in empty
    return cupy.ndarray(shape, dtype, order=order)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "cupy/_core/core.pyx", line 151, in cupy._core.core.ndarray.__new__
  File "cupy/_core/core.pyx", line 239, in cupy._core.core._ndarray_base._init
  File "cupy/cuda/memory.pyx", line 738, in cupy.cuda.memory.alloc
  File "/home/junjiey/anaconda3/envs/gpu4pyscf-occri/lib/python3.12/site-packages/gpu4pyscf/lib/cupy_helper.py", line 1127, in malloc
    return cuda_malloc(size)
           ^^^^^^^^^^^^^^^^^
  File "cupy/cuda/memory.pyx", line 633, in cupy.cuda.memory._malloc
  File "cupy/cuda/memory.pyx", line 634, in cupy.cuda.memory._malloc
  File "cupy/cuda/memory.pyx", line 101, in cupy.cuda.memory.Memory.__init__
  File "cupy_backends/cuda/api/runtime.pyx", line 499, in cupy_backends.cuda.api.runtime.malloc
  File "cupy_backends/cuda/api/runtime.pyx", line 146, in cupy_backends.cuda.api.runtime.check_status
cupy_backends.cuda.api.runtime.CUDARuntimeError: cudaErrorMemoryAllocation: out of memory
End time = Fri Nov 21 11:10:13 PM PST 2025
